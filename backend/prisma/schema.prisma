// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  STUDENT
  COUNSELLOR
  ADMIN
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  ACCEPTED
  REJECTED
  WAITLISTED
}

enum EducationLevel {
  HIGH_SCHOOL
  BACHELOR
  MASTER
  PHD
  DIPLOMA
}

enum EnglishLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  NATIVE
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  password      String
  firstName     String
  lastName      String
  phone         String?
  role          UserRole @default(STUDENT)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  studentProfile StudentProfile?
  applications  Application[]
  sentMessages  Message[]     @relation("SentMessages")
  receivedMessages Message[]  @relation("ReceivedMessages")

  @@index([email])
  @@index([role])
}

model School {
  id          String   @id @default(uuid())
  name        String
  description String?  @db.Text
  website     String?
  logo        String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  courses     Course[]

  @@index([isActive])
}

model Course {
  id              String   @id @default(uuid())
  schoolId        String
  name            String
  level           String   // Undergraduate, Postgraduate, Foundation, etc.
  duration        String   // e.g., "3 years", "1 year"
  tuitionFee      Decimal  @db.Decimal(10, 2)
  currency        String   @default("GBP")
  description     String   @db.Text
  requirements    String   @db.Text
  startDate       String   // e.g., "September 2024"
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  school          School   @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  applications    Application[]

  @@index([schoolId])
  @@index([level])
  @@index([isActive])
}

model Application {
  id                String            @id @default(uuid())
  userId            String
  courseId          String
  status            ApplicationStatus @default(DRAFT)
  personalStatement String?           @db.Text
  additionalInfo    String?           @db.Text
  submittedAt       DateTime?
  reviewedAt        DateTime?
  reviewedBy        String?
  adminNotes        String?           @db.Text
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  // Relations
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  course            Course            @relation(fields: [courseId], references: [id])
  documents         Document[]
  messages          Message[]

  @@index([userId])
  @@index([courseId])
  @@index([status])
  @@index([submittedAt])
}

model Document {
  id            String      @id @default(uuid())
  applicationId String
  fileName      String
  fileType      String
  fileSize      Int
  s3Key         String
  s3Url         String
  uploadedAt    DateTime    @default(now())

  // Relations
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
}

model StudentProfile {
  id                        String        @id @default(uuid())
  userId                    String        @unique
  dateOfBirth               DateTime?
  nationality               String?
  address                   String?
  educationLevel            EducationLevel?
  currentInstitution        String?
  major                     String?
  gpa                       String?
  englishLevel              EnglishLevel?
  workExperience            String?
  personalStatement         String?
  profileCompletionPercentage Int         @default(0)
  createdAt                 DateTime      @default(now())
  updatedAt                 DateTime      @updatedAt

  // Relations
  user                      User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Message {
  id            String      @id @default(uuid())
  applicationId String?
  senderId      String
  receiverId    String
  subject       String
  content       String      @db.Text
  isRead        Boolean     @default(false)
  createdAt     DateTime    @default(now())

  // Relations
  application   Application? @relation(fields: [applicationId], references: [id], onDelete: SetNull)
  sender        User         @relation("SentMessages", fields: [senderId], references: [id])
  receiver      User         @relation("ReceivedMessages", fields: [receiverId], references: [id])

  @@index([applicationId])
  @@index([senderId])
  @@index([receiverId])
  @@index([isRead])
}

model FormField {
  id          String   @id @default(uuid())
  label       String
  fieldType   String   // text, email, select, textarea, file, date, etc.
  placeholder String?
  required    Boolean  @default(false)
  options     String?  @db.Text // JSON string for select/radio options
  order       Int
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([order])
  @@index([isActive])
}
